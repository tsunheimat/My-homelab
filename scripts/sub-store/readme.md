orginal script location: https://github.com/Keywos/rule/blob/main/rename.js

# Sub-Store 節點重新命名與清洗腳本

這是一個功能強大的 Sub-Store 腳本操作（Script Operator），旨​​在將雜亂無章的代理節點名稱標準化。它可以自動識別國家/地區，添加國旗，保留關鍵線路資訊（如 IPLC、倍率），並按照你喜歡的格式輸出。

## ✨ 主要功能

* **多模式辨識**：自動辨識中文、英文全名、英文縮寫、國旗圖示等多種格式的節點名稱。
* **格式統一**：將節點統一重新命名為 `國旗 + 國家名 + 序號` 的標準格式（例如：`🇭🇰 香港 01` 或 `🇺🇸 US 01`）。
* **智慧保留**：支援保留特定關鍵字（如 IPLC、IEPL）、倍率（1.5x）、以及自訂的線路識別。
* **關鍵字替換**：支援在保留關鍵字的同時進行重新命名（例如將 `GPT` 替換為 `OpenAI`）。
* **垃圾清洗**：自動過濾包含「到期」、「官網」、「剩餘流量」等無效節點。
* **自動去重與排序**：自動為同名節點新增序號，並支援將優質線路（如專線）排在前面。

## 🚀 使用方法

在 Sub-Store 的 **腳本操作 (Script Operator)** 中新增此腳本的 URL，並在 URL 後透過 `#` 新增參數。

**基本語法：**

```url
https://raw.githubusercontent.com/tsunheimat/My-homelab/refs/heads/main/scripts/sub-store/rename.js#參數1&參數2=值&參數3

```

---

## ⚙️ 參數詳解

所有參數均透過 URL Hash 傳遞，多個參數以 `&` 連接。

### 1. 輸入與輸出控制 (基礎)

| 參數 | 說明 | 範例 |
| --- | --- | --- |
| **`in`** | **輸入格式指定**<br>

<br>預設為自動判斷。若識別不準，可強制指定原始名稱的類型。 <br>

<br>可選值：`zh`(中文), `us`/`en`(英文簡寫), `quan`(英文全名), `flag`(國旗)。 | `#in=us` |
| **`out`** | **輸出格式指定**<br>

<br>重新命名後的國家名格式。 **預設為中文**。 <br>

<br>可選值：`zh`(中文), `us`/`en`(英文簡寫), `quan`(英文全名), `flag`/`gq`(僅國旗)。 | `#out=us` (輸出 HK, US) |
| **`nm`** | **保留未符合節點**<br>

<br>預設情況下，無法辨識國家的節點會被刪除。新增此參數可保留原名。 | `#nm` |

### 2. 格式與美化 (前綴/後綴/國旗)

| 參數 | 說明 | 範例 |
| --- | --- | --- |
| **`flag`** | **新增國旗**<br>

<br>在節點名稱最前方加入對應的 emoji 國旗。 | `#flag` |
| **`fgf`** | **分隔符號**<br>

<br>設定前綴、國旗、國家名稱之間的分隔符號。預設為空格。 | `#fgf= |
| **`sn`** | **序號分隔符號**<br>

<br>設定國家名稱與序號（01, 02）之間的分隔符號。預設為空格。 | `#sn=_` |
| **`name`** | **新增自訂前綴**<br>

<br>在節點名稱最前方（或國旗後）新增自訂名稱（如機場名稱）。 | `#name=我的機場` |
| **`nf`** | **前綴優先**<br>

<br>配合 `name` 使用，將自訂前綴放在國旗前面。 | `#nf` |
| **`one`** | **單節點去零**<br>

<br>如果某地區只有一個節點，則不顯示序號（去掉 "01"）。 | `#one` |

### 3. 過濾與關鍵字保留 (核心)

| 參數 | 說明 | 範例 |
| --- | --- | --- |
| **`blkey`** | **保留關鍵字**<br>

<br>提取並保留原名中的特定字元。多個字用 `+` 連接。 <br>

<br>支援重新命名：`舊名>新名`。 | `#blkey=IPLC+GPT>AI` |
| **`blgd`** | **保留固定標識**<br>

<br>開啟內建正規庫，保留 `IPLC`, `IEPL`, `家寬`, `Game` 等常見識別。 | `#blgd` |
| **`bl`** | **保留倍率**<br>

<br>自動正規匹配並保留節點中的倍率（如 `1.5x`, `3倍`）。 | `#bl` |
| **`nx`** | **保留全部倍率節點**<br>

<br>保留1倍率和不顯示倍率的節點（通常配合濾波邏輯使用）。 | `#nx` |
| **`blnx`** | **只保留高倍率**<br>

<br>僅保留名稱中帶有高倍率標識的節點，過濾掉普通節點。 | `#blnx` |
| **`clear`** | **清理垃圾節點**<br>

<br>過濾包含「到期」、「剩餘」、「官網」、「群組」、「客服」等關鍵字的節點。 | `#clear` |
| **`blockquic`** | **QUIC 控制**<br>

<br>強行開啟或關閉節點的 QUIC 設定。 <br>

<br>可選值：`on`, `off`。 | `#blockquic=off` |

### 4. 排序

| 參數 | 說明 | 範例 |
| --- | --- | --- |
| **`blpx`** | **特殊節點置頂**<br>

<br>將包含 `blgd` 或 `blkey` 中匹配到的特殊節點（如 IPLC）排在前面。 | `#blpx` |

---

## 📝 設定範例

以下是幾種常見的配置場景組合：

#### 場景 1：極簡模式（中文 + 自動序號）

將所有節點重新命名為“香港 01”，“美國 01”等。

```text
#clear

```

#### 場景 2：英文簡寫 + 國旗 + 保留倍率 + 保留專線標識

*輸入：* `[機場] Hong Kong IPLC 專線 1.5x`
*輸出：* `🇭🇰 HK IPLC 1.5× 01`

```text
#out=us&flag&bl&blkey=IPLC

```

#### 場景 3：自訂前綴 + 取代關鍵字 + 特殊符號分隔

*輸入：* `US_GPT_Line_05`
*輸出：* `MyProxy-🇺🇸-美國-OpenAI-05`
*邏輯：* 新增前綴 MyProxy，分隔符號 -，將 GPT 改名為 OpenAI，輸出中文國家名稱。

```text
#name=MyProxy&flag&fgf=-&blkey=GPT>OpenAI

```

#### 場景 4：只保留進階節點並排序

只保留有高倍率標識的節點，且將 IPLC 等專線排在最前面。

```text
#blnx&blpx&blgd

```

---

## ⚠️ 注意事項

1. **執行順序**：腳本會優先進行正規清洗，然後​​提取關鍵字，最後組合成新名字。
2. **國旗識別**：如果使用了 `in=flag`，腳本會嘗試讀取原名中的 emoji 國旗來判斷國家，請確保不要在腳本操作前移除國旗。
3. **正規匹配**：腳本內建了龐大的國家/城市匹配庫（包含中文、英文、常用別名如「獅城」、「大坂」等），一般情況下不需要手動指定 `in` 參數。
4. **特殊字元**：URL 參數中避免使用特殊符號，盡量使用 `decodeURI` 支援的字元。