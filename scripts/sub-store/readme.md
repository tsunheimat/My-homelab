
orginal script location: https://github.com/Keywos/rule/blob/main/rename.js

# Sub-Store 节点重命名与清洗脚本

这是一个功能强大的 Sub-Store 脚本操作（Script Operator），旨在将杂乱无章的代理节点名称标准化。它可以自动识别国家/地区，添加国旗，保留关键线路信息（如 IPLC、倍率），并按照你喜欢的格式输出。

## ✨ 主要功能

* **多模式识别**：自动识别中文、英文全称、英文缩写、国旗图标等多种格式的节点名。
* **格式统一**：将节点统一重命名为 `国旗 + 国家名 + 序号` 的标准格式（例如：`🇭🇰 香港 01` 或 `🇺🇸 US 01`）。
* **智能保留**：支持保留特定关键词（如 IPLC、IEPL）、倍率（1.5x）、以及自定义的线路标识。
* **关键词替换**：支持在保留关键词的同时进行重命名（例如将 `GPT` 替换为 `OpenAI`）。
* **垃圾清洗**：自动过滤包含“到期”、“官网”、“剩余流量”等无效节点。
* **自动去重与排序**：自动为同名节点添加序号，并支持将优质线路（如专线）排在前面。

## 🚀 使用方法

在 Sub-Store 的 **脚本操作 (Script Operator)** 中添加此脚本的 URL，并在 URL 后通过 `#` 添加参数。

**基本语法：**

```url
https://raw.githubusercontent.com/tsunheimat/My-homelab/refs/heads/main/scripts/sub-store/rename.js#参数1&参数2=值&参数3

```

---

## ⚙️ 参数详解

所有参数均通过 URL Hash 传递，多个参数用 `&` 连接。

### 1. 输入与输出控制 (基础)

| 参数 | 说明 | 示例 |
| --- | --- | --- |
| **`in`** | **输入格式指定**<br>

<br>默认为自动判断。如果识别不准，可强制指定原始名称的类型。<br>

<br>可选值：`zh`(中文), `us`/`en`(英文简写), `quan`(英文全称), `flag`(国旗)。 | `#in=us` |
| **`out`** | **输出格式指定**<br>

<br>重命名后的国家名格式。**默认为中文**。<br>

<br>可选值：`zh`(中文), `us`/`en`(英文简写), `quan`(英文全称), `flag`/`gq`(仅国旗)。 | `#out=us` (输出 HK, US) |
| **`nm`** | **保留未匹配节点**<br>

<br>默认情况下，无法识别国家的节点会被删除。添加此参数可保留原名。 | `#nm` |

### 2. 格式与美化 (前缀/后缀/国旗)

| 参数 | 说明 | 示例 |
| --- | --- | --- |
| **`flag`** | **添加国旗**<br>

<br>在节点名称最前方添加对应的 emoji 国旗。 | `#flag` |
| **`fgf`** | **分隔符**<br>

<br>设置前缀、国旗、国家名之间的分隔符。默认为空格。 | `#fgf= |
| **`sn`** | **序号分隔符**<br>

<br>设置国家名与序号（01, 02）之间的分隔符。默认为空格。 | `#sn=_` |
| **`name`** | **添加自定义前缀**<br>

<br>在节点名最前方（或国旗后）添加自定义名称（如机场名）。 | `#name=我的机场` |
| **`nf`** | **前缀优先**<br>

<br>配合 `name` 使用，将自定义前缀放在国旗前面。 | `#nf` |
| **`one`** | **单节点去零**<br>

<br>如果某地区只有一个节点，则不显示序号（去掉 "01"）。 | `#one` |

### 3. 过滤与关键词保留 (核心)

| 参数 | 说明 | 示例 |
| --- | --- | --- |
| **`blkey`** | **保留关键词**<br>

<br>提取并保留原名中的特定字符。多个词用 `+` 连接。<br>

<br>支持重命名：`旧名>新名`。 | `#blkey=IPLC+GPT>AI` |
| **`blgd`** | **保留固定标识**<br>

<br>开启内置正则库，保留 `IPLC`, `IEPL`, `家宽`, `Game` 等常见标识。 | `#blgd` |
| **`bl`** | **保留倍率**<br>

<br>自动正则匹配并保留节点中的倍率（如 `1.5x`, `3倍`）。 | `#bl` |
| **`nx`** | **保留全部倍率节点**<br>

<br>保留1倍率和不显示倍率的节点（通常配合过滤逻辑使用）。 | `#nx` |
| **`blnx`** | **只保留高倍率**<br>

<br>仅保留名称中带有高倍率标识的节点，过滤掉普通节点。 | `#blnx` |
| **`clear`** | **清理垃圾节点**<br>

<br>过滤包含“到期”、“剩余”、“官网”、“群”、“客服”等关键词的节点。 | `#clear` |
| **`blockquic`** | **QUIC 控制**<br>

<br>强行开启或关闭节点的 QUIC 设置。<br>

<br>可选值：`on`, `off`。 | `#blockquic=off` |

### 4. 排序

| 参数 | 说明 | 示例 |
| --- | --- | --- |
| **`blpx`** | **特殊节点置顶**<br>

<br>将包含 `blgd` 或 `blkey` 中匹配到的特殊节点（如 IPLC）排在前面。 | `#blpx` |

---

## 📝 配置示例

以下是几种常见的配置场景组合：

#### 场景 1：极简模式（中文 + 自动序号）

将所有节点重命名为“香港 01”，“美国 01”等。

```text
#clear

```

#### 场景 2：英文简写 + 国旗 + 保留倍率 + 保留专线标识

*输入：* `[机场] Hong Kong IPLC 专线 1.5x`
*输出：* `🇭🇰 HK IPLC 1.5× 01`

```text
#out=us&flag&bl&blkey=IPLC

```

#### 场景 3：自定义前缀 + 替换关键词 + 特殊符号分隔

*输入：* `US_GPT_Line_05`
*输出：* `MyProxy-🇺🇸-美国-OpenAI-05`
*逻辑：* 添加前缀 MyProxy，分隔符用 -，将 GPT 改名为 OpenAI，输出中文国家名。

```text
#name=MyProxy&flag&fgf=-&blkey=GPT>OpenAI

```

#### 场景 4：只保留高级节点并排序

只保留带有高倍率标识的节点，且将 IPLC 等专线排在最前面。

```text
#blnx&blpx&blgd

```

---

## ⚠️ 注意事项

1. **执行顺序**：脚本会优先进行正则清洗，然后提取关键词，最后组合成新名字。
2. **国旗识别**：如果使用了 `in=flag`，脚本会尝试读取原名中的 emoji 国旗来判断国家，请确保不要在脚本操作前移除国旗。
3. **正则匹配**：脚本内置了庞大的国家/城市匹配库（包含中文、英文、常用别名如“狮城”、“大坂”等），一般情况下不需要手动指定 `in` 参数。
4. **特殊字符**：URL 参数中避免使用特殊符号，尽量使用 `decodeURI` 支持的字符。